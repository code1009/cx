/////////////////////////////////////////////////////////////////////////////
//===========================================================================
#include "pch.hpp"

//===========================================================================
#include "wui.hpp"





/////////////////////////////////////////////////////////////////////////////
//===========================================================================
namespace cx::wui
{





/////////////////////////////////////////////////////////////////////////////
//===========================================================================
void WindowMessageLoop::addIdleHandler(IdleHandler handler)
{
	_idleHandlers.push_back(handler);
}

//===========================================================================
void WindowMessageLoop::run(void)
{
	//-----------------------------------------------------------------------
	MSG msg;
	BOOL rv;


	do
	{
#if 0
		rv = ::GetMessageW(&msg, nullptr, 0, 0);
		if (rv != 0)
		{
			::TranslateMessage(&msg);
			::DispatchMessageW(&msg);
		}
		else
		{
			break;
		}
#else
		rv = ::PeekMessageW(&msg, nullptr, 0, 0, PM_REMOVE);
		if (rv != 0)
		{
			::TranslateMessage(&msg);
			::DispatchMessageW(&msg);
		}
		else
		{
			onIdle();
		}
#endif
	} while (msg.message != WM_QUIT);
}

void WindowMessageLoop::onIdle(void)
{
	for (auto& handler : _idleHandlers)
	{
		handler();
	}
}





/////////////////////////////////////////////////////////////////////////////
//===========================================================================
}




